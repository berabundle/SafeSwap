{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst wallet_1 = require(\"../wallet\");\nconst permissions_1 = require(\"../types/permissions\");\nconst hasPermission = (required, permissions) => permissions.some(permission => permission.parentCapability === required);\nconst requirePermission = () => (_, propertyKey, descriptor) => {\n  const originalMethod = descriptor.value;\n  descriptor.value = async function () {\n    // @ts-expect-error accessing private property from decorator. 'this' context is the class instance\n    const wallet = new wallet_1.Wallet(this.communicator);\n    let currentPermissions = await wallet.getPermissions();\n    if (!hasPermission(propertyKey, currentPermissions)) {\n      currentPermissions = await wallet.requestPermissions([{\n        [propertyKey]: {}\n      }]);\n    }\n    if (!hasPermission(propertyKey, currentPermissions)) {\n      throw new permissions_1.PermissionsError('Permissions rejected', permissions_1.PERMISSIONS_REQUEST_REJECTED);\n    }\n    return originalMethod.apply(this);\n  };\n  return descriptor;\n};\nexports.default = requirePermission;","map":{"version":3,"names":["wallet_1","require","permissions_1","hasPermission","required","permissions","some","permission","parentCapability","requirePermission","_","propertyKey","descriptor","originalMethod","value","wallet","Wallet","communicator","currentPermissions","getPermissions","requestPermissions","PermissionsError","PERMISSIONS_REQUEST_REJECTED","apply","exports","default"],"sources":["/home/oliver/Projects/SafeSwap/node_modules/@safe-global/safe-apps-sdk/src/decorators/requirePermissions.ts"],"sourcesContent":["import { Methods } from '../communication';\nimport { Safe } from '../safe';\nimport { Wallet } from '../wallet';\n\nimport { Permission, PermissionsError, PERMISSIONS_REQUEST_REJECTED } from '../types/permissions';\n\nconst hasPermission = (required: Methods, permissions: Permission[]): boolean =>\n  permissions.some((permission) => permission.parentCapability === required);\n\nconst requirePermission = () => (_: unknown, propertyKey: string, descriptor: PropertyDescriptor) => {\n  const originalMethod = descriptor.value;\n\n  descriptor.value = async function () {\n    // @ts-expect-error accessing private property from decorator. 'this' context is the class instance\n    const wallet = new Wallet((this as Safe).communicator);\n\n    let currentPermissions = await wallet.getPermissions();\n\n    if (!hasPermission(propertyKey as Methods, currentPermissions)) {\n      currentPermissions = await wallet.requestPermissions([{ [propertyKey as Methods]: {} }]);\n    }\n\n    if (!hasPermission(propertyKey as Methods, currentPermissions)) {\n      throw new PermissionsError('Permissions rejected', PERMISSIONS_REQUEST_REJECTED);\n    }\n\n    return originalMethod.apply(this);\n  };\n\n  return descriptor;\n};\n\nexport default requirePermission;\n"],"mappings":";;;;;AAEA,MAAAA,QAAA,GAAAC,OAAA;AAEA,MAAAC,aAAA,GAAAD,OAAA;AAEA,MAAME,aAAa,GAAGA,CAACC,QAAiB,EAAEC,WAAyB,KACjEA,WAAW,CAACC,IAAI,CAAEC,UAAU,IAAKA,UAAU,CAACC,gBAAgB,KAAKJ,QAAQ,CAAC;AAE5E,MAAMK,iBAAiB,GAAGA,CAAA,KAAM,CAACC,CAAU,EAAEC,WAAmB,EAAEC,UAA8B,KAAI;EAClG,MAAMC,cAAc,GAAGD,UAAU,CAACE,KAAK;EAEvCF,UAAU,CAACE,KAAK,GAAG,kBAAK;IACtB;IACA,MAAMC,MAAM,GAAG,IAAIf,QAAA,CAAAgB,MAAM,CAAE,IAAa,CAACC,YAAY,CAAC;IAEtD,IAAIC,kBAAkB,GAAG,MAAMH,MAAM,CAACI,cAAc,EAAE;IAEtD,IAAI,CAAChB,aAAa,CAACQ,WAAsB,EAAEO,kBAAkB,CAAC,EAAE;MAC9DA,kBAAkB,GAAG,MAAMH,MAAM,CAACK,kBAAkB,CAAC,CAAC;QAAE,CAACT,WAAsB,GAAG;MAAE,CAAE,CAAC,CAAC;;IAG1F,IAAI,CAACR,aAAa,CAACQ,WAAsB,EAAEO,kBAAkB,CAAC,EAAE;MAC9D,MAAM,IAAIhB,aAAA,CAAAmB,gBAAgB,CAAC,sBAAsB,EAAEnB,aAAA,CAAAoB,4BAA4B,CAAC;;IAGlF,OAAOT,cAAc,CAACU,KAAK,CAAC,IAAI,CAAC;EACnC,CAAC;EAED,OAAOX,UAAU;AACnB,CAAC;AAEDY,OAAA,CAAAC,OAAA,GAAehB,iBAAiB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}