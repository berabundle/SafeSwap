(()=>{var e={3720:(e,t,r)=>{"use strict";var a=r(9950),s=r(1352),o=r(7009),n=r(7775),i=r(5869),l=r(4489),c=r(9808),d=r(6491),u=r(2053),p=r(226),h=r(3380),m=r(426),y=r(9925),x=r(2046),f=r(975),g=r(957),A=r(2235),v=r(249),j=r(3511),b=r(8614),w=r(1413),k=r(3563),S=r(899),I=r(9715),O=r(4414);const P=e=>{let{tokens:t,selectedTokens:r,onSelect:s}=e;const[o,n]=(0,a.useState)(""),[i,l]=(0,a.useState)(!1),[c,h]=(0,a.useState)({}),m=(0,a.useMemo)((()=>t.filter((e=>{const t=e.name.toLowerCase().includes(o.toLowerCase())||e.symbol.toLowerCase().includes(o.toLowerCase());if(!i){const r=e.balance||"0",a=parseFloat(r)>0;return t&&a}return t}))),[t,o,i]),P=(e,t)=>{h((r=>({...r,[e]:t})))};return(0,O.jsxs)(d.A,{mb:4,children:[(0,O.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Select Tokens to Swap"}),(0,O.jsx)(y.A,{fullWidth:!0,placeholder:"Search tokens...",value:o,onChange:e=>n(e.target.value),InputProps:{startAdornment:(0,O.jsx)(x.A,{position:"start",children:(0,O.jsx)(I.A,{})})},margin:"normal",variant:"outlined"}),(0,O.jsx)(d.A,{display:"flex",justifyContent:"flex-end",mt:1,children:(0,O.jsx)(f.A,{control:(0,O.jsx)(g.A,{checked:i,onChange:e=>l(e.target.checked),color:"primary",size:"small"}),label:(0,O.jsx)(u.A,{variant:"body2",color:"textSecondary",children:"Show zero balances"})})}),(0,O.jsx)(A.A,{variant:"outlined",sx:{mt:2,maxHeight:400,overflow:"auto"},children:(0,O.jsxs)(v.A,{children:[m.map((e=>{const t=e.balance||"0",a=e.priceUsd?`$${e.priceUsd.toFixed(2)}`:"",o=(n=e.address,r.some((e=>e.token.address===n)));var n;const i=c[e.address]||"";return(0,O.jsxs)(j.Ay,{divider:!0,sx:{opacity:o?.5:1},children:[(0,O.jsx)(b.A,{children:(0,O.jsx)(w.A,{src:e.logoURI,alt:e.symbol,children:e.symbol.charAt(0)})}),(0,O.jsx)(k.A,{primary:(0,O.jsxs)(d.A,{display:"flex",justifyContent:"space-between",children:[(0,O.jsx)("span",{children:e.symbol}),a&&(0,O.jsx)("span",{children:a})]}),secondary:(0,O.jsxs)(d.A,{children:[(0,O.jsx)(u.A,{variant:"caption",children:e.name}),(0,O.jsxs)(u.A,{variant:"caption",display:"block",children:["Balance: ",t]})]})}),(0,O.jsxs)(d.A,{sx:{minWidth:200,ml:2},children:[(0,O.jsxs)(S.Ay,{container:!0,spacing:1,alignItems:"center",children:[(0,O.jsx)(S.Ay,{item:!0,xs:8,children:(0,O.jsx)(y.A,{size:"small",type:"number",placeholder:"Amount",value:i,onChange:t=>P(e.address,t.target.value),disabled:o,fullWidth:!0,InputProps:{endAdornment:(0,O.jsx)(x.A,{position:"end",children:(0,O.jsx)(u.A,{variant:"caption",color:"primary",sx:{cursor:"pointer"},onClick:()=>!o&&(e=>{const t=e.balance||"0";P(e.address,t)})(e),children:"MAX"})})}})}),(0,O.jsx)(S.Ay,{item:!0,xs:4,children:(0,O.jsx)(p.A,{size:"small",variant:"contained",onClick:()=>(e=>{const t=c[e.address]||"";if(t&&parseFloat(t)>0){const r=t===e.balance;s(e,t,r),h((t=>({...t,[e.address]:""})))}})(e),disabled:o||!i||parseFloat(i)<=0,fullWidth:!0,children:"Add"})})]}),e.priceUsd&&i&&parseFloat(i)>0&&(0,O.jsxs)(u.A,{variant:"caption",color:"textSecondary",children:["\u2248 $",(parseFloat(i)*e.priceUsd).toFixed(2)]})]})]},e.address)})),0===m.length&&(0,O.jsx)(j.Ay,{children:(0,O.jsx)(k.A,{primary:"No tokens found"})})]})})]})};var E=r(1378),B=r(5333),C=r(5979),F=r(3788),T=r(5076),U=r(9474),_=r(3174),$=r(6639),z=r(7988),R=r(9076),N=r(8699),K=r(9878);const M=["function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)"];const q=new class{constructor(){this.sdk=void 0,this.apiKey=void 0,this.apiEndpoint=void 0,this.sdk=null,this.apiKey=null,this.apiEndpoint="https://corsproxy.io/?https://api.oogabooga.com/v1/swap"}initialize(e,t,r){return this.sdk=e,r&&(this.apiKey=r),80085!==t&&console.warn(`SwapBundleService: Chain ID ${t} is not fully supported yet`),Boolean(this.sdk)}isInitialized(){return Boolean(this.sdk)}async prepareBundleTransactions(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;if(!this.isInitialized())return{success:!1,error:"SwapBundleService not initialized"};if(!this.apiKey)return{success:!1,error:"API key not set"};try{const s=e.filter((e=>{let{amount:t}=e;return parseFloat(t)>0}));if(0===s.length)return{success:!1,error:"No valid swaps to execute"};const o=await Promise.all(s.map((e=>{let{token:r,amount:s}=e;return this.getSwapQuote(r,s,t,a)}))),n=[];let i=0,l=N.g5("0");for(let e=0;e<s.length;e++){const{token:a,amount:c}=s[e],d=o[e];if(a.priceUsd&&(i+=parseFloat(c)*a.priceUsd),l+=N.XS(d.outputAmount,t.decimals),!a.isNative){const e=await this.createApprovalTransaction(a,d.routerAddress,c,r);e&&n.push(e)}n.push({to:d.routerAddress,value:a.isNative?N.XS(c,a.decimals).toString():"0",data:d.calldata})}return{success:!0,txs:n,totalValueUsd:i,estimatedOutput:N.Js(l,t.decimals)}}catch(s){return console.error("Error preparing bundle transactions:",s),{success:!1,error:s.message}}}async createApprovalTransaction(e,t,r,a){try{const a=new K.KA(M),s=N.XS(r,e.decimals),o=a.encodeFunctionData("approve",[t,s]);return{to:e.address,value:"0",data:o}}catch(s){throw console.error(`Error creating approval for ${e.symbol}:`,s),s}}async getSwapQuote(e,t,r,a){try{const s=e.isNative||"BERA"===e.symbol,o=N.XS(t,e.decimals),n=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({chainId:80085,tokenIn:s?"native":e.address,tokenOut:r.address,amount:o.toString(),slippage:a})});if(!n.ok){const e=await n.text();throw new Error(`API request failed: ${n.status} ${e}`)}const i=await n.json();return{routerAddress:i.routerAddress,calldata:i.calldata,outputAmount:i.outputAmount,minOutputAmount:i.minOutputAmount,priceImpact:i.priceImpact||0}}catch(s){throw console.error("Error fetching swap quote:",s),s}}},L=e=>{let{selectedTokens:t,availableTokens:r,onRemoveToken:s,onSwap:n,apiKey:i}=e;const{sdk:l,safe:c}=(0,o.useSafeAppsSDK)(),[h,m]=(0,a.useState)(null),[y,x]=(0,a.useState)(!1),[f,g]=(0,a.useState)(null),[S,I]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(!h&&r.length>0){const e=r.find((e=>"BERA"===e.symbol||e.isNative));m(e||r[0])}}),[r,h]),(0,a.useEffect)((()=>{l&&c&&q.initialize(l,c.chainId,i||void 0)}),[l,c,i]);const P=(0,a.useCallback)((async()=>{if(h&&0!==t.length&&q.isInitialized()){x(!0),g(null);try{const e=await q.prepareBundleTransactions(t,h,c.safeAddress,.5);e.success&&e.txs?I({totalValueUsd:e.totalValueUsd||0,estimatedOutput:e.estimatedOutput||"0",slippage:.5}):(g(e.error||"Failed to generate swap quote"),I(null))}catch(e){console.error("Error generating swap quote:",e),g(e.message||"Unknown error generating swap quote"),I(null)}finally{x(!1)}}}),[t,h,c.safeAddress]);(0,a.useEffect)((()=>{t.length>0&&h&&i?P():I(null)}),[t,h,i,P]);const N=t.reduce(((e,t)=>{let{token:r,amount:a}=t;return r.priceUsd?e+parseFloat(a)*r.priceUsd:e}),0);return 0===t.length?null:(0,O.jsxs)(d.A,{mb:4,children:[(0,O.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Swap Bundle"}),(0,O.jsxs)(A.A,{variant:"outlined",sx:{p:2},children:[(0,O.jsxs)(d.A,{mb:2,children:[(0,O.jsxs)(u.A,{variant:"subtitle2",gutterBottom:!0,children:["Input Tokens (",t.length,")"]}),(0,O.jsx)(v.A,{dense:!0,children:t.map((e=>{let{token:t,amount:r}=e;return(0,O.jsxs)(j.Ay,{children:[(0,O.jsx)(b.A,{children:(0,O.jsx)(w.A,{src:t.logoURI,alt:t.symbol,sx:{width:32,height:32},children:t.symbol.charAt(0)})}),(0,O.jsx)(k.A,{primary:`${r} ${t.symbol}`,secondary:t.priceUsd?`$${(parseFloat(r)*t.priceUsd).toFixed(2)}`:null}),(0,O.jsx)(E.A,{children:(0,O.jsx)(B.A,{edge:"end",size:"small",onClick:()=>s(t.address),children:(0,O.jsx)(z.A,{fontSize:"small"})})})]},t.address)}))}),N>0&&(0,O.jsxs)(u.A,{variant:"body2",color:"textSecondary",align:"right",children:["Total Input: $",N.toFixed(2)]})]}),(0,O.jsx)(d.A,{display:"flex",justifyContent:"center",my:2,children:(0,O.jsx)(R.A,{color:"primary"})}),(0,O.jsx)(d.A,{mb:3,children:(0,O.jsxs)(C.A,{fullWidth:!0,variant:"outlined",size:"small",children:[(0,O.jsx)(F.A,{id:"target-token-label",children:"Output Token"}),(0,O.jsx)(T.A,{labelId:"target-token-label",value:(null===h||void 0===h?void 0:h.address)||"",onChange:e=>{const t=e.target.value,a=r.find((e=>e.address===t));a&&m(a)},label:"Output Token",children:r.map((e=>(0,O.jsx)(U.A,{value:e.address,children:(0,O.jsxs)(d.A,{display:"flex",alignItems:"center",children:[(0,O.jsx)(w.A,{src:e.logoURI,sx:{width:24,height:24,mr:1},children:e.symbol.charAt(0)}),(0,O.jsx)("span",{children:e.symbol})]})},e.address)))})]})}),S&&(0,O.jsxs)(d.A,{mb:3,p:2,bgcolor:"rgba(18, 255, 128, 0.05)",borderRadius:1,children:[(0,O.jsx)(u.A,{variant:"subtitle2",gutterBottom:!0,children:"Estimated Output"}),(0,O.jsxs)(u.A,{variant:"h6",children:[parseFloat(S.estimatedOutput).toFixed(6)," ",null===h||void 0===h?void 0:h.symbol]}),(null===h||void 0===h?void 0:h.priceUsd)&&(0,O.jsxs)(u.A,{variant:"body2",color:"textSecondary",children:["\u2248 $",(parseFloat(S.estimatedOutput)*h.priceUsd).toFixed(2)]}),(0,O.jsxs)(u.A,{variant:"caption",color:"textSecondary",display:"block",mt:1,children:["Slippage: ",S.slippage,"%"]})]}),f&&(0,O.jsx)(_.A,{severity:"error",sx:{mb:2},children:f}),(0,O.jsx)(p.A,{variant:"contained",color:"primary",size:"large",fullWidth:!0,onClick:async()=>{if(h&&0!==t.length&&S){x(!0),g(null);try{const e=await q.prepareBundleTransactions(t,h,c.safeAddress);if(e.success&&e.txs){const t={targetToken:h,totalValueUsd:S.totalValueUsd,estimatedOutput:parseFloat(S.estimatedOutput)};await l.txs.send({txs:e.txs}),n(t),I(null)}else g(e.error||"Failed to prepare transactions")}catch(e){console.error("Swap execution failed:",e),g(e.message||"Unknown error executing swap")}finally{x(!1)}}else g("Cannot execute swap without a valid quote")},disabled:y||!S||!i,startIcon:y?(0,O.jsx)($.A,{size:20}):(0,O.jsx)(R.A,{}),children:y?"Processing...":"Execute Swap"}),!i&&(0,O.jsx)(u.A,{variant:"caption",color:"error",display:"block",mt:1,textAlign:"center",children:"Please enter your API key above"})]})]})};var W=r(6882);const X=e=>`https://corsproxy.io/?https://api.oogabooga.com${e}`,V=e=>({method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`,"X-Requested-With":"XMLHttpRequest"},mode:"cors",credentials:"omit"}),D=["function balanceOf(address owner) view returns (uint256)","function decimals() view returns (uint8)","function symbol() view returns (string)","function name() view returns (string)"],J=(0,n.A)({palette:{mode:"dark",primary:{main:"#12FF80"},secondary:{main:"#303030"}}}),H=()=>{const{sdk:e,safe:t}=(0,o.useSafeAppsSDK)(),[r,s]=(0,a.useState)(!1),[n,y]=(0,a.useState)([]),[x,f]=(0,a.useState)([]),[g,A]=(0,a.useState)(null),[v,j]=(0,a.useState)((()=>localStorage.getItem("oogabooga_api_key")||"")),[b,w]=(0,a.useState)(!1),k=(0,a.useMemo)((()=>{const r=new h.U(t,e);return new m.k(r)}),[e,t]),S=(0,a.useCallback)((async()=>{if(!v)return A("Please enter your OogaBooga API key to load tokens"),void s(!1);try{s(!0),A(null);const e=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{if(!e||!e.trim())throw new Error("API key required for token list");const t=await fetch(X("/v1/tokens"),V(e));if(!t.ok){const e=await t.text();if(401===t.status)throw new Error("Invalid API key. Please check your OogaBooga API key.");throw new Error(`API error: ${t.status} ${e}`)}const r=(await t.json()).map((e=>({name:e.name,symbol:e.symbol,address:e.address,decimals:e.decimals,chainId:80085,logoURI:e.tokenURI||"",isNative:"0x0000000000000000000000000000000000000000"===e.address})));return r.find((e=>e.isNative))||r.unshift({name:"Bera",symbol:"BERA",address:"0x0000000000000000000000000000000000000000",decimals:18,chainId:80085,logoURI:"",isNative:!0}),{tokens:r}}catch(g){throw console.error("Error fetching token list:",g),new Error(g.message||"Failed to fetch token list")}}(v),r=e.tokens.filter((e=>e.chainId===t.chainId)),a=await(async(e,t,r)=>{try{return await Promise.all(e.map((async e=>{try{let a="0";if(e.isNative)a=N.ck(await r.getBalance(t));else{const s=new W.NZ(e.address,D,r),o=await s.balanceOf(t);a=N.Js(o,e.decimals)}return{...e,balance:a}}catch(g){return console.error(`Error fetching balance for token ${e.symbol}:`,g),{...e,balance:"0"}}})))}catch(g){throw console.error("Error fetching token balances:",g),new Error("Failed to fetch token balances")}})(r,t.safeAddress,k),o=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!t)return e;const r=await fetch(X("/v1/prices"),V(t));if(!r.ok){const e=await r.text();if(401===r.status)throw new Error("Invalid API key. Please check your OogaBooga API key.");throw new Error(`API error: ${r.status} ${e}`)}const a=await r.json(),s=new Map;return a.forEach((e=>{s.set(e.address.toLowerCase(),e.price)})),e.map((e=>{const t=e.isNative?"0x0000000000000000000000000000000000000000":e.address.toLowerCase();return{...e,priceUsd:s.get(t)||0}}))}catch(g){return console.error("Error fetching token prices:",g),e}}(a,v);y(o),A(null),w(!0)}catch(e){const t=e.message||"Failed to load tokens";A(t),console.error(e)}finally{s(!1)}}),[t.chainId,t.safeAddress,k,v]);(0,a.useEffect)((()=>{v&&!b&&S()}),[v,b,S]);return(0,O.jsxs)(i.A,{theme:J,children:[(0,O.jsx)(l.Ay,{}),(0,O.jsx)(c.A,{maxWidth:"md",children:(0,O.jsxs)(d.A,{my:4,children:[(0,O.jsx)(u.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"SafeSwap"}),g&&(0,O.jsx)(u.A,{color:"error",variant:"body2",children:g}),n.length>0&&(0,O.jsx)(P,{tokens:n,onSelect:(e,t,r)=>{f((a=>{const s=a.findIndex((t=>t.token.address===e.address));if(s>=0){const o=[...a];return o[s]={token:e,amount:t,isMax:r},o}return[...a,{token:e,amount:t,isMax:r}]}))},selectedTokens:x}),!r&&0===n.length&&v&&(0,O.jsx)(d.A,{mb:3,children:(0,O.jsx)(u.A,{color:"textSecondary",children:"No tokens found. Please check your API key and try again."})}),(0,O.jsxs)(d.A,{mb:3,children:[(0,O.jsx)(u.A,{variant:"subtitle1",gutterBottom:!0,children:"OogaBooga API Key"}),(0,O.jsxs)(d.A,{display:"flex",gap:1,children:[(0,O.jsx)("input",{type:"password",value:v,onChange:e=>{return t=e.target.value,j(t),void(t?localStorage.setItem("oogabooga_api_key",t):localStorage.removeItem("oogabooga_api_key"));var t},placeholder:"Enter your API key",style:{flex:1,padding:"10px",borderRadius:"4px",border:"1px solid #444",background:"transparent",color:"white"}}),(0,O.jsx)(p.A,{variant:"contained",onClick:S,disabled:!v||r,children:r?"Loading...":"Load Tokens"}),b&&(0,O.jsx)(p.A,{variant:"outlined",onClick:()=>{localStorage.removeItem("oogabooga_token_list"),localStorage.removeItem("oogabooga_token_list_expiry"),S()},disabled:!v||r,children:"Refresh"})]}),(0,O.jsx)(u.A,{variant:"caption",color:"textSecondary",children:"Your API key is required for fetching tokens and prices. Key is stored locally."})]}),n.length>0&&(0,O.jsx)(L,{selectedTokens:x,onRemoveToken:e=>{f((t=>t.filter((t=>t.token.address!==e))))},onSwap:async e=>{if(0!==x.length)if(v)try{s(!0),console.log("Swap bundle executed:",e),f([]),A(null),await S()}catch(t){console.error("Swap failed:",t),A(`Failed to execute swap: ${t.message||"Unknown error"}`)}finally{s(!1)}else A("Please enter your OogaBooga API key to perform swaps");else A("Please select at least one token to swap")},availableTokens:n,apiKey:v})]})})]})};s.createRoot(document.getElementById("root")).render((0,O.jsx)(a.StrictMode,{children:(0,O.jsx)(o.SafeProvider,{children:(0,O.jsx)(H,{})})}))},7790:()=>{}},t={};function r(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.m=e,r.amdO={},(()=>{var e=[];r.O=(t,a,s,o)=>{if(!a){var n=1/0;for(d=0;d<e.length;d++){a=e[d][0],s=e[d][1],o=e[d][2];for(var i=!0,l=0;l<a.length;l++)(!1&o||n>=o)&&Object.keys(r.O).every((e=>r.O[e](a[l])))?a.splice(l--,1):(i=!1,o<n&&(n=o));if(i){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[a,s,o]}})(),r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(a,s){if(1&s&&(a=this(a)),8&s)return a;if("object"===typeof a&&a){if(4&s&&a.__esModule)return a;if(16&s&&"function"===typeof a.then)return a}var o=Object.create(null);r.r(o);var n={};e=e||[null,t({}),t([]),t(t)];for(var i=2&s&&a;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((e=>n[e]=()=>a[e]));return n.default=()=>a,r.d(o,n),o}})(),r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={792:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var s,o,n=a[0],i=a[1],l=a[2],c=0;if(n.some((t=>0!==e[t]))){for(s in i)r.o(i,s)&&(r.m[s]=i[s]);if(l)var d=l(r)}for(t&&t(a);c<n.length;c++)o=n[c],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(d)},a=self.webpackChunksafe_swap=self.webpackChunksafe_swap||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=r.O(void 0,[121],(()=>r(3720)));a=r.O(a)})();